<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>C. Word Anatomy</title><link rel="stylesheet" type="text/css" href="docbook-xsl.css" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><link rel="home" href="index.html" title="durexForth: Operators Manual" /><link rel="up" href="index.html" title="durexForth: Operators Manual" /><link rel="prev" href="apb.html" title="B. Memory Map" /><link rel="next" href="apd.html" title="D. Avoiding Stack Crashes" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><td width="20%" align="left"><a accesskey="p" href="apb.html"><img src="images/icons/prev.png" alt="Prev" /></a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="apd.html"><img src="images/icons/next.png" alt="Next" /></a></td></tr></table><hr /></div><div class="appendix"><div class="titlepage"><div><div><h2 class="title"><a id="_word_anatomy"></a>C. Word Anatomy</h2></div></div></div><p>Let us define a word and see what it gets compiled to.</p><pre class="screen">: bg $d020 c! ;</pre><p>Information about the word is split into two areas of memory, the dictionary and the code/data space. Code and data are placed in an upward-growing segment starting at $801, and the dictionary grows downward from <code class="literal">top</code>. <code class="literal">latest</code> points to the last dictionary record. A dictionary record consists of a counted string with flags, and an execution token (<span class="emphasis"><em>xt</em></span>).</p><p>To inspect the dictionary entry, type <code class="literal">latest dump</code>. You should see something like this:</p><pre class="screen">6228  02 42 47 fd 39 28 39 01 .bg.9(9.
...</pre><p>For this run, the name token of <code class="literal">bg</code> is placed at address $6228. The first byte, <code class="literal">02</code>, is the length of <code class="literal">bg</code> name string. After that, the string <code class="literal">bg</code> follows. ($42 = <code class="literal">b</code>, $47 = <code class="literal">g</code>). The final two bytes contain the execution token of <code class="literal">bg</code>, starting at $39fd.</p><p>The name length byte is also used to store special attributes of the word. Bit 7 is "immediate" flag, which means that the word should execute immediately instead of being compiled into word definitions. (<code class="literal">(</code> is such an example of an immediate word that does not get compiled.) Bit 6 is the "no-tail-call-elimination" flag, which makes sure that tail call elimination (the practice of replacing jsr/rts with jmp) is not performed if this word is the jsr target. Since <code class="literal">bg</code> does not have these flags set, bits 7 and 6 are both clear.</p><p>We saw that the <code class="literal">bg</code> execution token is $39fd. To inspect the code, type <code class="literal">$39fd dump</code> or <code class="literal">latest &gt;xt dump</code>.</p><p>The code section contains pure 6502 machine code.</p><pre class="screen">39fd  <a id="CO1-1"></a><span><img src="images/icons/callouts/1.png" alt="1" border="0" /></span>20 15 11 <a id="CO1-2"></a><span><img src="images/icons/callouts/2.png" alt="2" border="0" /></span>20 d0 <a id="CO1-3"></a><span><img src="images/icons/callouts/3.png" alt="3" border="0" /></span>4c 0e 09  .. Pl..
...</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="#CO1-1"><span><img src="images/icons/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
20 15 11 ( jsr $1115 ) $1115 is the address of the <code class="literal">lit</code> code. <code class="literal">lit</code> copies the two following bytes to parameter stack.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO1-2"><span><img src="images/icons/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
20 d0 ( $d020 ) The parameter to the <code class="literal">lit</code> word. When executed, <code class="literal">lit</code> will add $d020 to the parameter stack.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO1-3"><span><img src="images/icons/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
4c 0e 09 ( jmp $90e ) $90e is the address of the <code class="literal">c!</code> code.
</p></td></tr></table></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="apb.html"><img src="images/icons/prev.png" alt="Prev" /></a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="apd.html"><img src="images/icons/next.png" alt="Next" /></a></td></tr><tr><td width="40%" align="left" valign="top"> </td><td width="20%" align="center"><a accesskey="h" href="index.html"><img src="images/icons/home.png" alt="Home" /></a></td><td width="40%" align="right" valign="top"> </td></tr></table></div></body></html>